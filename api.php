<?php
header("Content-Type:application/json");

$ip_pool = [
    "10.64.0.0/16",
	"10.65.0.0/16",
	"10.66.0.0/16",
	"10.67.0.0/16",
	"10.68.0.0/16",
	"10.69.0.0/16",
	"10.70.0.0/16",
	"10.71.0.0/16",
	"10.72.0.0/16",
	"10.73.0.0/16",
	"10.74.0.0/16",
	"10.75.0.0/16",
	"10.76.0.0/16",
	"10.77.0.0/16",
	"10.78.0.0/16",
	"10.79.0.0/16",
	"10.80.0.0/16",
	"10.81.0.0/16",
	"10.82.0.0/16",
	"10.83.0.0/16",
	"10.84.0.0/16",
	"10.85.0.0/16",
	"10.86.0.0/16",
	"10.87.0.0/16",
	"10.88.0.0/16",
	"10.89.0.0/16",
	"10.90.0.0/16",
	"10.91.0.0/16",
	"10.92.0.0/16",
	"10.93.0.0/16",
	"10.94.0.0/16",
	"10.95.0.0/16",
	"10.96.0.0/16",
	"10.97.0.0/16",
	"10.98.0.0/16",
	"10.99.0.0/16",
	"10.100.0.0/16",
	"10.101.0.0/16",
	"10.102.0.0/16",
	"10.103.0.0/16",
	"10.104.0.0/16",
	"10.105.0.0/16",
	"10.106.0.0/16",
	"10.107.0.0/16",
	"10.108.0.0/16",
	"10.109.0.0/16",
	"10.110.0.0/16",
	"10.111.0.0/16",
	"10.112.0.0/16",
	"10.113.0.0/16",
	"10.114.0.0/16",
	"10.115.0.0/16",
	"10.116.0.0/16",
	"10.117.0.0/16",
	"10.118.0.0/16",
	"10.119.0.0/16",
	"10.120.0.0/16",
	"10.121.0.0/16",
	"10.124.0.0/16",
	"10.125.0.0/16",
	"10.126.0.0/16",
	"10.127.0.0/16",
	"10.128.0.0/16",
	"10.129.0.0/16",
	"10.130.0.0/16",
	"10.131.0.0/16",
	"10.132.0.0/16",
	"10.133.0.0/16",
	"10.134.0.0/16",
	"10.135.0.0/16",
	"10.136.0.0/16",
	"10.137.0.0/16",
	"10.138.0.0/16",
	"10.139.0.0/16",
	"10.140.0.0/16",
	"10.141.0.0/16",
	"10.142.0.0/16",
	"10.143.0.0/16",
	"10.144.0.0/16",
	"10.145.0.0/16",
	"10.146.0.0/16",
	"10.147.0.0/16",
	"10.148.0.0/16",
	"10.149.0.0/16",
	"10.150.0.0/16",
	"10.152.0.0/16",
	"10.153.0.0/16",
	"10.154.0.0/16",
	"10.155.0.0/16",
	"10.156.0.0/16",
	"10.157.0.0/16",
	"10.158.0.0/16",
	"10.159.0.0/16",
	"10.160.0.0/16",
	"10.161.0.0/16",
	"10.162.0.0/16",
	"10.163.0.0/16",
	"10.164.0.0/16",
	"10.165.0.0/16",
	"10.166.0.0/16",
	"10.167.0.0/16",
	"10.168.0.0/16",
	"10.169.0.0/16",
	"10.170.0.0/16",
	"10.171.0.0/16",
	"10.172.0.0/16",
	"10.173.0.0/16",
	"10.174.0.0/16",
	"10.175.0.0/16",
	"10.176.0.0/16",
	"10.177.0.0/16",
	"10.178.0.0/16",
	"10.179.0.0/16",
	"10.180.0.0/16",
	"10.181.0.0/16",
	"10.182.0.0/16",
	"10.183.0.0/16",
	"10.184.0.0/16",
	"10.185.0.0/16",
	"10.186.0.0/16",
	"10.190.0.0/16",
	"10.191.0.0/16",
	"10.192.0.0/16",
	"10.193.0.0/16",
	"10.194.0.0/16",
	"10.195.0.0/16",
	"10.196.0.0/16",
	"10.197.0.0/16",
	"10.198.0.0/16",
	"10.199.0.0/16",
	"10.200.0.0/16",
	"10.201.0.0/16",
	"10.202.0.0/16",
	"10.203.0.0/16",
	"10.204.0.0/16",
	"10.205.0.0/16",
	"10.206.0.0/16",
	"10.207.0.0/16",
	"10.208.0.0/16",
	"10.209.0.0/16",
	"10.210.0.0/16",
	"10.211.0.0/16",
	"10.212.0.0/16",
	"10.213.0.0/16",
	"10.214.0.0/16",
	"10.215.0.0/16",
	"10.216.0.0/16",
	"10.217.0.0/16",
	"10.218.0.0/16",
	"10.219.0.0/16",
	"10.220.0.0/16",
	"10.221.0.0/16",
	"10.222.0.0/16",
	"10.223.0.0/16",
	"10.224.0.0/16",
	"10.225.0.0/16",
	"10.226.0.0/16",
	"10.227.0.0/16",
	"10.228.0.0/16",
	"10.229.0.0/16",
	"10.230.0.0/16",
	"10.231.0.0/16",
	"10.232.0.0/16",
	"10.233.0.0/16",
	"10.234.0.0/16",
	"10.235.0.0/16",
	"10.236.0.0/16",
	"10.237.0.0/16",
	"10.238.0.0/16",
	"10.239.0.0/16",
	"10.240.0.0/16",
	"10.241.0.0/16",
	"10.242.0.0/16",
	"10.243.0.0/16",
	"10.244.0.0/16",
	"10.245.0.0/16",
	"10.246.0.0/16",
	"10.187.0.0/16",
	"10.188.0.0/16",
	"10.189.0.0/16",
	"45.121.24.0/22",
	"103.199.76.0/22",
	"103.53.252.0/22",
	"103.199.20.0/22",
	"103.199.24.0/22",
	"103.199.28.0/22",
	"103.199.32.0/22",
	"103.199.36.0/22",
	"103.199.40.0/22",
	"103.199.44.0/22",
	"103.199.48.0/22",
	"103.199.52.0/22",
	"103.199.56.0/22",
	"103.199.60.0/22",
	"103.199.64.0/22",
	"103.199.68.0/22",
	"103.199.72.0/22",
	"59.153.220.0/22",
	"59.153.224.0/22",
	"59.153.228.0/22",
	"59.153.232.0/22",
	"59.153.240.0/22",
	"59.153.236.0/22",
	"59.153.244.0/22",
	"59.153.252.0/22",
	"59.153.248.0/22",
	"137.59.32.0/22",
	"137.59.36.0/22",
	"137.59.28.0/22",
	"137.59.24.0/22",
	"137.59.40.0/22",
	"137.59.44.0/22"
];

function checkIpPool($real_ip, $ip_pool)
{
    $split = explode(".", $real_ip);
    if(isset($split[0]) && $split[1]){
        $prefix_ip = $split[0] . "." . $split[1];
        foreach ($ip_pool as $ip){
            if (strpos($ip, $prefix_ip) !== false) {
                return true;
            }
        }
    }
    return false;
}

response(200,"OK",$ip_pool);

function response($status,$status_message,$ip_pool)
{
	header("HTTP/1.1 ".$status);
    $response['status']=$status;
    $response['status_message']=$status_message;

    $data = null;
    foreach (getallheaders() as $name => $value) {
        $data[strtolower($name)]=$value;
    }

    if(!isset($data["x-real-ip"])){
        $data['msisdn']=null;
    }else if(!checkIpPool($data["x-real-ip"],$ip_pool)){
        $data['msisdn']=null;
    }

    $response['data'] = $data;
	
	$json_response = json_encode($response);
	echo $json_response;
}